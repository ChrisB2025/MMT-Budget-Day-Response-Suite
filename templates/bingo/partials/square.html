<div
    id="square-{{ square.id }}"
    class="bingo-square group aspect-square relative {% if square.marked %}marked{% elif square.position == 12 %}free{% endif %} min-h-[60px] sm:min-h-[70px]"
    {% if not square.marked and not card.completed %}
    hx-post="{% url 'bingo:mark_square' square.id %}"
    hx-trigger="click"
    hx-swap="outerHTML"
    hx-target="#square-{{ square.id }}"
    hx-indicator="#loading-{{ square.id }}"
    {% endif %}
    x-data="{ showTooltip: false }"
    @mouseenter="showTooltip = true"
    @mouseleave="showTooltip = false"
    role="button"
    aria-pressed="{% if square.marked %}true{% else %}false{% endif %}"
    tabindex="0"
    {% if not square.marked and not card.completed %}
    @keydown.enter="$el.click()"
    @keydown.space.prevent="$el.click()"
    {% endif %}
>
    {% if square.position == 12 %}
        <p class="text-[10px] xs:text-xs sm:text-sm md:text-base font-bold">FREE SPACE</p>
        <p class="text-[8px] xs:text-xs mt-0.5 sm:mt-1" style="opacity: 0.9;">Auto-marked! ðŸŽ‰</p>
    {% else %}
        <p class="text-[9px] xs:text-[10px] sm:text-xs md:text-sm font-medium leading-tight break-words">
            {{ square.phrase.phrase_text }}
        </p>
    {% endif %}

    {% if square.marked %}
        <span class="text-2xl sm:text-3xl md:text-4xl mt-0.5 sm:mt-1 font-bold animate-bounce">âœ“</span>
    {% else %}
        {% if not card.completed %}
            <span id="loading-{{ square.id }}" class="htmx-indicator absolute inset-0 flex items-center justify-center rounded-lg" style="background: var(--color-playful-light);">
                <svg class="animate-spin h-8 w-8" style="color: var(--color-playful);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </span>
        {% endif %}
    {% endif %}

    {% if square.phrase.description and square.position != 12 %}
        <!-- Tooltip -->
        <div
            x-show="showTooltip"
            x-transition
            class="absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 rounded-lg shadow-lg max-w-xs pointer-events-none text-xs"
            style="display: none; background: var(--color-text-primary); color: white;"
        >
            <p class="font-semibold mb-1">{{ square.phrase.phrase_text }}</p>
            <p style="color: #e5e7eb;">{{ square.phrase.description|truncatewords:20 }}</p>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                <div class="border-4 border-transparent" style="border-top-color: var(--color-text-primary);"></div>
            </div>
        </div>
    {% endif %}
</div>
