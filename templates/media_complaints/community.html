{% extends 'base.html' %}

{% block title %}Community Complaints - MMT Budget Response Suite{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">Community Complaints</h1>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <form method="get" class="flex flex-wrap gap-4 items-end">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                <select name="status" class="px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All</option>
                    <option value="draft" {% if status_filter == 'draft' %}selected{% endif %}>Draft</option>
                    <option value="generated" {% if status_filter == 'generated' %}selected{% endif %}>Generated</option>
                    <option value="sent" {% if status_filter == 'sent' %}selected{% endif %}>Sent</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Outlet</label>
                <select name="outlet" class="px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="all" {% if outlet_filter == 'all' %}selected{% endif %}>All Outlets</option>
                    {% for outlet in outlets %}
                    <option value="{{ outlet.id }}" {% if outlet_filter == outlet.id|stringformat:"s" %}selected{% endif %}>
                        {{ outlet.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                Filter
            </button>
        </form>
    </div>

    <!-- Complaints -->
    {% if complaints %}
    <div class="space-y-4">
        {% for complaint in complaints %}
        <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded">
                            {{ complaint.outlet.name }}
                        </span>
                        <span class="text-xs text-gray-500">{{ complaint.incident_date|date:"j M Y" }}</span>
                        {% if complaint.status == 'sent' %}
                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded">
                            ✓ Sent
                        </span>
                        {% endif %}
                    </div>
                    <h3 class="text-lg font-bold text-gray-900 mb-2">{{ complaint.programme_name }}</h3>
                    <p class="text-sm text-gray-600 line-clamp-2 mb-2">{{ complaint.claim_description|truncatewords:25 }}</p>
                    <div class="flex items-center gap-3 text-xs text-gray-500">
                        <span>By {{ complaint.user.display_name }}</span>
                        <span>•</span>
                        <span>Severity: {{ complaint.severity }}/5</span>
                    </div>
                </div>
                <a href="{% url 'media_complaints:view_complaint' complaint.id %}" class="ml-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-semibold">
                    View
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500">No complaints found matching your filters.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
