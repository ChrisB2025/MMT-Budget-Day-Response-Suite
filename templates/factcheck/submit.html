{% extends 'base.html' %}

{% block title %}Submit Fact-Check - MMT Budget Response Suite{% endblock %}

{% block extra_head %}
<style>
    @keyframes greenFlash {
        0%, 100% { background-color: white; }
        50% { background-color: #d1fae5; }
    }

    @keyframes blueP pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.8; }
    }

    @keyframes goldShine {
        0% { box-shadow: 0 0 0 0 rgba(252, 211, 77, 0.7); }
        50% { box-shadow: 0 0 20px 10px rgba(252, 211, 77, 0.4); }
        100% { box-shadow: 0 0 0 0 rgba(252, 211, 77, 0); }
    }

    .flash-green {
        animation: greenFlash 0.8s ease-in-out;
    }

    .pulse-blue {
        animation: bluePulse 1s ease-in-out infinite;
    }

    .shine-gold {
        animation: goldShine 1.5s ease-in-out;
    }

    .severity-badge-8, .severity-badge-9, .severity-badge-10 {
        background-color: #ef4444;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 0.375rem;
        font-weight: bold;
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes confetti-fall {
        0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        z-index: 9999;
        animation: confetti-fall 3s linear;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Submit Claim for Fact-Checking</h1>

        <!-- Live Stats Banner -->
        {% if user_profile %}
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 mb-6">
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold">{{ user_profile.total_claims_submitted|default:0 }}</div>
                    <div class="text-sm opacity-90">Claims Submitted</div>
                </div>
                <div>
                    <div class="text-2xl font-bold">{{ user_profile.experience_points|default:0 }}</div>
                    <div class="text-sm opacity-90">XP</div>
                </div>
                <div>
                    <div class="text-2xl font-bold">{{ user_profile.level|upper|default:'BRONZE' }}</div>
                    <div class="text-sm opacity-90">Level</div>
                </div>
            </div>
        </div>
        {% endif %}

        <form method="post" id="factcheck-form">
            {% csrf_token %}

            <div class="mb-6">
                <label for="{{ form.claim_text.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Claim to Fact-Check *
                </label>
                {{ form.claim_text }}
                {% if form.claim_text.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.claim_text.errors.0 }}</p>
                {% endif %}
                <p class="mt-1 text-sm text-gray-500">üí° Tip: Be specific and quote exactly what was said</p>
            </div>

            <div class="mb-6">
                <label for="{{ form.context.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Additional Context (optional)
                </label>
                {{ form.context }}
                {% if form.context.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.context.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="mb-6">
                <label for="{{ form.timestamp_in_speech.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Timestamp in Speech (optional)
                </label>
                {{ form.timestamp_in_speech }}
                <p class="mt-1 text-sm text-gray-500">Example: 12:45:30</p>
            </div>

            <div class="mb-6">
                <label for="{{ form.severity.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                    Severity Rating (1-10) *
                </label>
                {{ form.severity }}
                <p class="mt-1 text-sm text-gray-500">How misleading is this claim? (1 = minor, 10 = extremely misleading)</p>
                <div class="mt-2 flex gap-2 items-center">
                    <div class="text-xs text-gray-600">1-3: Minor</div>
                    <div class="text-xs text-gray-600">4-6: Moderate</div>
                    <div class="text-xs text-gray-600">7-9: Serious</div>
                    <div class="text-xs font-bold text-red-600">10: Critical</div>
                </div>
                {% if form.severity.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.severity.errors.0 }}</p>
                {% endif %}
            </div>

            <div class="flex gap-4">
                <button
                    type="submit"
                    id="submit-btn"
                    class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold transition-all duration-200 transform hover:scale-105">
                    üîç Submit for Fact-Check
                </button>
                <a href="{% url 'factcheck:home' %}" class="px-6 py-3 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors">
                    Cancel
                </a>
            </div>
        </form>

        <!-- Rewards Preview -->
        <div class="mt-8 p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
            <h3 class="font-semibold text-gray-900 mb-2">üéÅ Rewards for Submitting:</h3>
            <ul class="space-y-1 text-sm text-gray-700">
                <li>‚úÖ +10 XP per claim</li>
                <li>üî• Hot Streak bonus (5+ claims within 5 min)</li>
                <li>üèÜ Earn badges for milestones</li>
                <li>‚≠ê Level up: Bronze ‚Üí Silver ‚Üí Gold ‚Üí Platinum</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.getElementById('factcheck-form').addEventListener('submit', function(e) {
    const btn = document.getElementById('submit-btn');
    btn.classList.add('flash-green');
    btn.disabled = true;
    btn.innerHTML = '‚è≥ Submitting...';

    // Add blue pulse effect to the whole form
    setTimeout(() => {
        document.querySelector('.bg-white').classList.add('pulse-blue');
    }, 800);
});

// Confetti animation function
function createConfetti() {
    const colors = ['#fbbf24', '#10b981', '#3b82f6', '#ef4444', '#8b5cf6'];
    for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 3000);
    }
}

// Check if there's a success message (badge earned)
{% if messages %}
    {% for message in messages %}
        {% if 'badge' in message.message|lower or 'streak' in message.message|lower %}
            createConfetti();
        {% endif %}
    {% endfor %}
{% endif %}
</script>
{% endblock %}
